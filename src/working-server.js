const express = require('express');
const path = require('path');

const app = express();

// Middleware Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(express.static('.'));

console.log('ğŸš€ Ø³ÛŒØ³ØªÙ… Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­ - Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯...');

// Ù…ÙˆØªÙˆØ± Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ú©Ø§Ø±Ø¢Ù…Ø¯
class ResponseEngine {
    generateAnswer(question) {
        const q = question.toLowerCase().trim();
        
        // Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡
        if (q.includes('Ø³Ù„Ø§Ù…') || q.includes('hello')) {
            return `ğŸ§  **Ø³Ù„Ø§Ù…! Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.**

ğŸ”§ **Ø³ÛŒØ³ØªÙ… ÙØ¹Ø§Ù„ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø®Ø¯Ù…Ø§Øªâ€ŒØ±Ø³Ø§Ù†ÛŒ Ø§Ø³Øª**
ğŸ’¡ **Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø§ÛŒÙ† Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ú©Ù…Ú© Ú©Ù†Ù…:**
â€¢ Ù…Ø¹Ø±ÙÛŒ Ø±Ø§Ù…ÛŒÙ† Ø§Ø¬Ù„Ø§Ù„ Ùˆ ØªØ®ØµØµâ€ŒÙ‡Ø§ÛŒØ´
â€¢ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ùˆ ÙÙ†Ø§ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆÛŒÙ†
â€¢ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¢Ù†

ğŸ¯ **Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.**`;
        }
        
        if (q.includes('Ø±Ø§Ù…ÛŒÙ†') || q.includes('Ø§Ø¬Ù„Ø§Ù„')) {
            return `ğŸ‘¤ **Ø±Ø§Ù…ÛŒÙ† Ø§Ø¬Ù„Ø§Ù„ - ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ùˆ Ù…Ø­Ù‚Ù‚ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ**

ğŸ¯ **ØªØ®ØµØµâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ:**
â€¢ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ùˆ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
â€¢ ØªÙˆØ³Ø¹Ù‡ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÙˆØ²ÛŒØ¹â€ŒØ´Ø¯Ù‡
â€¢ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±

ğŸ† **Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø¨Ø±Ø¬Ø³ØªÙ‡:**
- ØªÙˆØ³Ø¹Ù‡ Ø³ÛŒØ³ØªÙ… Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­
- ØªØ­Ù‚ÛŒÙ‚ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ
- Ø·Ø±Ø§Ø­ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡

ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø³ÙˆØ§Ù„ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`;
        }
        
        if (q.includes('Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ')) {
            return `ğŸ¤– **Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ - ØªØ­Ù„ÛŒÙ„ Ø±Ø§Ù…ÛŒÙ† Ø§Ø¬Ù„Ø§Ù„**

ğŸ”® **Ø±ÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ:**
1. **Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙØ³ÛŒØ±Ù¾Ø°ÛŒØ±**: Ø´ÙØ§ÙÛŒØª Ø¯Ø± ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ
2. **ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ú†Ù†Ø¯ÙˆØ¬Ù‡ÛŒ**: Ø§Ø¯ØºØ§Ù… Ù…ØªÙ†ØŒ ØµÙˆØª Ùˆ ØªØµÙˆÛŒØ±
3. **Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ù…Ø®ØªØ§Ø±**: ØªØ¹Ø§Ø¯Ù„ Ø¨ÛŒÙ† Ú©Ù†ØªØ±Ù„ Ùˆ Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ†

ğŸ’ **ØªÙ…Ø±Ú©Ø² Ø±Ø§Ù…ÛŒÙ†**: ØªÙˆØ³Ø¹Ù‡ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ø³Ø¦ÙˆÙ„ Ùˆ Ø´ÙØ§Ù`;
        }
        
        if (q.includes('Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù†') || q.includes('ÙØ§Ø±Ø³ÛŒ')) {
            return `ğŸ“š **Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ - Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ Ùˆ ÙØ±ØµØªâ€ŒÙ‡Ø§**

ğŸ¯ **Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ:**
â€¢ Ú©Ù…Ø¨ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø§ Ú©ÛŒÙÛŒØª
â€¢ Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ ØµØ±ÙÛŒ Ùˆ Ù†Ø­ÙˆÛŒ
â€¢ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ ÙØ±Ù‡Ù†Ú¯ ÙØ§Ø±Ø³ÛŒ

ğŸš€ **Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§:**
- ØªÙˆØ³Ø¹Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ ØªØ®ØµØµÛŒ
- Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø²Ø¨Ø§Ù†ÛŒ Ø¨Ø²Ø±Ú¯ ÙØ§Ø±Ø³ÛŒ
- ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ù†Ø´ Ø²Ø¨Ø§Ù†â€ŒØ´Ù†Ø§Ø³ÛŒ`;
        }
        
        // Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        return `ğŸ§  **ØªØ­Ù„ÛŒÙ„ Ø³ÙˆØ§Ù„ Ø´Ù…Ø§**

Ø³ÙˆØ§Ù„ "${question}" Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯.

ğŸ’¡ **Ù…Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ø§ÛŒÙ† Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ Ú©Ù…Ú© Ú©Ù†Ù…:**
â€¢ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªØ®ØµØµÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø±Ø§Ù…ÛŒÙ† Ø§Ø¬Ù„Ø§Ù„
â€¢ ØªØ­Ù„ÛŒÙ„ ØªØ­ÙˆÙ„Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ  
â€¢ Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
â€¢ Ù…Ø¨Ø§Ø­Ø« ÙÙ†ÛŒ Ùˆ ØªØ­Ù‚ÛŒÙ‚Ø§ØªÛŒ

ğŸ¯ **Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ØŒ Ù„Ø·ÙØ§Ù‹ Ø­ÙˆØ²Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.**`;
    }
}

// Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÙˆØªÙˆØ±
const engine = new ResponseEngine();

// API Ú†Øª Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡
app.get('/api/chat', (req, res) => {
    try {
        // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø±Ø§Ù…ØªØ± q Ø§Ø² query string
        const question = req.query.q;
        
        console.log('ğŸ“¥ Ø¯Ø±ÛŒØ§ÙØª Ø³ÙˆØ§Ù„:', question);
        
        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø§Ø¯Ù‡
        if (!question) {
            return res.status(400).json({
                success: false,
                error: 'Ù¾Ø§Ø±Ø§Ù…ØªØ± q Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª',
                example: 'Ø§Ø² /api/chat?q=Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯'
            });
        }
        
        if (typeof question !== 'string') {
            return res.status(400).json({
                success: false,
                error: 'Ù¾Ø§Ø±Ø§Ù…ØªØ± q Ø¨Ø§ÛŒØ¯ Ø±Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯'
            });
        }
        
        const trimmedQuestion = question.trim();
        
        if (trimmedQuestion.length < 1) {
            return res.status(400).json({
                success: false, 
                error: 'Ø³ÙˆØ§Ù„ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯'
            });
        }
        
        if (trimmedQuestion.length > 1000) {
            return res.status(400).json({
                success: false,
                error: 'Ø³ÙˆØ§Ù„ Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û±Û°Û°Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯'
            });
        }
        
        // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
        const answer = engine.generateAnswer(trimmedQuestion);
        
        res.json({
            success: true,
            question: trimmedQuestion,
            answer: answer,
            timestamp: new Date().toISOString()
        });
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± API Ú†Øª:', error);
        res.status(500).json({
            success: false,
            error: 'Ø®Ø·Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ø³Ø±ÙˆØ±',
            message: error.message
        });
    }
});

// API ÙˆØ¶Ø¹ÛŒØª
app.get('/api/status', (req, res) => {
    res.json({
        status: 'active',
        system: 'Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­ - Ø³ÛŒØ³ØªÙ… Ù¾Ø§ÛŒØ¯Ø§Ø±',
        version: '2.0.0',
        capabilities: [
            'Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³ÙˆØ§Ù„Ø§Øª ÙØ§Ø±Ø³ÛŒ',
            'Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯',
            'Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§'
        ],
        timestamp: new Date().toISOString()
    });
});

// Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³
app.get('/health', (req, res) => {
    res.json({ 
        status: 'healthy', 
        timestamp: new Date().toISOString(),
        message: 'Ø³ÛŒØ³ØªÙ… Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­ ÙØ¹Ø§Ù„ Ø§Ø³Øª'
    });
});

// Ø±ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ©
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, '../index.html'));
});

app.get('/ai-interface.html', (req, res) => {
    res.sendFile(path.join(__dirname, '../ai-interface.html'));
});

const PORT = process.env.PORT || 3001;
app.listen(PORT, () => {
    console.log(`ğŸš€ Ø³ÛŒØ³ØªÙ… Ù¾Ø§ÛŒØ¯Ø§Ø± Ù†Ø·Ù‚ Ù…ØµØ·Ù„Ø­ Ø¯Ø± Ù¾ÙˆØ±Øª ${PORT} Ø§Ø¬Ø±Ø§ Ø´Ø¯`);
    console.log(`ğŸ”— Ø¯Ø³ØªØ±Ø³ÛŒ: http://localhost:${PORT}/ai-interface.html`);
    console.log('âœ… Ø¢Ù…Ø§Ø¯Ù‡ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ');
});

module.exports = app;
